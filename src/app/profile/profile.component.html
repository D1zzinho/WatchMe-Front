<mat-progress-bar mode="indeterminate" color="warn" *ngIf="!(dataLoaded | async)"></mat-progress-bar>
<div class="container my-2" *ngIf="dataLoaded | async">

  <div class="profile-header ml-2 mb-2 mt-4">
    <img class="header-avatar rounded-circle" src="{{ avatar }}" alt="Avatar">

    <div class="user-meta">
      <h2 class="header-username">{{ username }}</h2>
      <p class="header-description">{{ (userType === 'system' ? 'WatchMe registered user' : 'GitHub authorized user') }}</p>
    </div>

  </div>

  <mat-tab-group class="my-4" animationDuration="0ms">
    <mat-tab label="Information">

      <mat-card class="mt-4" *ngIf="userType === 'github'">
        <h3 class="text-monospace text-muted">Name: <span class="text-white">{{ currentUserData['name'] === null ? 'not assigned' : currentUserData['name'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">E-mail address: <span class="text-white">{{ currentUserData['email'] === null ? 'not assigned' : currentUserData['email'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Bio: <br /><span class="text-white">{{ currentUserData['bio'] === null ? 'not assigned' : currentUserData['bio'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Private repos: <span class="text-white">{{ currentUserData['total_private_repos'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Public repos: <span class="text-white">{{ currentUserData['public_repos'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Last login: <span class="text-white">{{ currentUserData['lastLoginDate'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Registered in GitHub at: <span class="text-white">{{ currentUserData['created_at'] }}</span></h3>
      </mat-card>

      <mat-card class="mt-4" *ngIf="userType === 'system'">
        <h3 class="text-monospace text-muted">Name: <span class="text-white">{{ currentUserData['username'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">E-mail address: <span class="text-white">{{ currentUserData['email'] === null ? 'not assigned' : currentUserData['email'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Last login: <span class="text-white">{{ currentUserData['lastLoginDate'] }}</span></h3>
        <mat-divider></mat-divider>
        <h3 class="text-monospace text-muted pt-3">Registered at: <span class="text-white">{{ currentUserData['registerDate'] }}</span></h3>
        <!--        <h3 class="text-monospace text-muted">About: <p class="text-white">{{ currentUserData['about'] === null ? 'not set' : currentUserData['about'] }}</p></h3>-->
<!--        <h3 class="text-monospace text-muted">Registered at: <strong class="text-white">{{ currentUserData['lastLoginDate'] }}</strong></h3>-->
      </mat-card>

    </mat-tab>

    <mat-tab label="Videos">

      <h2 class="mt-4">Your videos ({{ currentUserVideos.length }})</h2>

      <div class="alert alert-warning my-3" *ngIf="currentUserVideos.length === 0">
        You don't have any uploaded videos! Maybe <a [routerLink]="['/uploadVideo']">upload</a> something special?
      </div>

      <div class="user-videos mt-0" *ngIf="currentUserVideos.length > 0">

        <div class="text-left h-100" *ngFor="let video of videosOnPage">
          <div class="user-video h-100 rgba-pink-light" [title]="video['title']">

            <a class="video-link" [routerLink]="['/player']" [queryParams]="{vid: video['_id']}"></a>
            <img
              src="{{ baseUrl }}/{{ video['cover'] }}"
              class="img-fluid"
              alt="{{ video['title'] }}"
            >

            <div class="user-video-info">
              <strong style="font-size: 12px; word-break: break-word;">{{ (video['title'].length > 30 ? video['title'].slice(0, 30) + '...' : video['title']) }}</strong>

              <button class="video-actions-menu" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Video actions" #menuTrigger>
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="openEditVideoDialog(video)">
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
                <button mat-menu-item (click)="openDeleteVideoDialog(video)">
                  <mat-icon>delete_forever</mat-icon>
                  <span>Delete</span>
                </button>
              </mat-menu>
            </div>

          </div>
        </div>
      </div>

      <mat-paginator
        color="accent"
        [showFirstLastButtons]="true"
        [length]="videosLength"
        [pageSize]="videosPerPage"
        [pageSizeOptions]="pageSizeOptions"
        (page)="pageEvent = handlePage($event)"
        [pageIndex]="currentPage"
      >
      </mat-paginator>

    </mat-tab>


    <mat-tab *ngIf="userType === 'github'" label="Repositories">

      <div class="alert alert-warning mt-3" *ngIf="currentUserRepos.length === 0 && (tableLoaded | async)">
        You don't have any repositories! Maybe create new one?
      </div>


      <div class="d-flex">
        <mat-form-field class="mt-3" color="accent">
          <mat-label>Search for repository</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Repo name" #input>
        </mat-form-field>

        <div class="m-0 ml-auto mt-auto mb-auto">
          <button mdbBtn size="sm" color="secondary" rounded="true" class="waves-light" (click)="openCreateRepoDialog()" mdbWavesEffect type="submit">Create repository</button>
        </div>
      </div>


      <div class="repo-table-holder mat-elevation-z8">
        <table class="w-100" mat-table [dataSource]="dataSource" matSort>

          <!-- Repo name column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
            <td mat-cell *matCellDef="let row"> {{row.name}} </td>
          </ng-container>

          <!-- Repo description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Description </th>
            <td mat-cell *matCellDef="let row"> {{row['description']}} </td>
          </ng-container>

          <!-- Repo private or public Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
            <td mat-cell *matCellDef="let row"> {{row['private'] ? 'Private' : 'Public'}} </td>
          </ng-container>

          <!-- Repo commits Column -->
          <ng-container matColumnDef="commits">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Commits </th>
            <td mat-cell *matCellDef="let row"><a (click)="openShowCommitsDialog(row['name'], row['owner']['login'], row['private'])"><mat-icon>mediation_icon</mat-icon></a></td>
          </ng-container>

          <!-- External link to repo column -->
          <ng-container matColumnDef="external_link">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> GitHub link </th>
            <td mat-cell *matCellDef="let row"><a href="{{row['html_url']}}" target="_blank"><mat-icon>input_icon</mat-icon></a></td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
          </tr>
        </table>

        <mat-paginator color="accent" #repoPaginator [pageSizeOptions]="[5, 10, 15, 20]"></mat-paginator>
      </div>

    </mat-tab>
  </mat-tab-group>

</div>
